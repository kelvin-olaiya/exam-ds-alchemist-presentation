<!DOCTYPE html><html lang="en"><head>
	<meta name="generator" content="Hugo 0.140.1">
    <meta charset="utf-8">
<title>Alchemist Simulation Batch Distribution </title>
<meta name="description" content="Distributed System exam project">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="./reveal-js/dist/reset.css">
<link rel="stylesheet" href="./reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="./css/custom-theme.min.96f9360e70e1d73951c068321f1ef0e65f3ae561fb1dae36819e06b8e14ac5aa.css" id="theme"><link rel="stylesheet" href="./highlight-js/solarized-dark.min.css">
<link rel="stylesheet" href="https://gitcdn.link/repo/DanySK/css-blur-animation/master/blur.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/81ac037be0.js" crossorigin="anonymous"></script>

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="alchemist-simulation-batch-distribution">Alchemist Simulation Batch Distribution</h1>
<h2 id="distributed-systems-project">Distributed Systems project</h2>
<p></p><div>
    <p>Kelvin Oluwada Milare Obuneme Olaiya</p>
    <p><a href="mailto://kelvinoluwada.olaiya@studio.unibo.it">kelvinoluwada.olaiya@studio.unibo.it</a></p>
</div>
A.Y. 2022/2023<p></p>
<p><a href="https://kelvin-olaiya.github.io/exam-ds-alchemist-report/">report</a></p>
</section><section>
<h1 id="introduction">Introduction</h1>
<h2 id="alchemist">Alchemist</h2>
<ul>
<li>Is a chemical-oriented general-purpose simulator</li>
<li>Open source</li>
</ul>
<figure><img src="./img/alchemist-meta-model.svg" alt="Alchemist’s meta-model" width="600"><figcaption>
      <p>Alchemist’s meta-model</p>
    </figcaption>
</figure>

</section><section>
<h1 id="introduction-1">Introduction</h1>
<h2 id="alchemist-1">Alchemist</h2>
<ul>
<li>To run one simulation one should:
<ol>
<li>Write a simulation configuration file in YAML</li>
<li>Launch the simulator</li>
<li>Wait for the completion</li>
<li>Possibly analyze any exported data</li>
</ol>
</li>
</ul>
</section><section>
<h1 id="the-problem">The problem</h1>
<ul>
<li>Sometimes it may be useful to execute the <strong><em>same configuration</em></strong> with <strong><em>different parameters</em></strong>, called <strong>variables</strong>.</li>
<li>The set of simulation differing by their variables constitute a <strong>batch</strong>.</li>
<li>Alchemist provides a way to launch a simulation batch <strong><em>sequentially</em></strong>.</li>
</ul>
<div class="callout callout-info">
Running a simulation can be time-consuming, let alone running a simulation batch.
</div>
</section><section>
<h1 id="the-problem-1">The problem</h1>
<h2 id="the-need-of-distribution">The need of distribution</h2>
<p>Taking advantage of <strong><em>multiple computing resources</em></strong> can be a way to <strong><em>reduce the time</em></strong> necessary to complete
the execution of a simulation batch.</p>
</section><section>
<h2 id="functional-requirements">Functional requirements</h2>
<ul>
<li>It should be possible to create a <strong>cluster of nodes</strong>, each executing a service exposing
Alchemist.</li>
<li>Alchemist should provide a way to <strong>distribute a batch of simulations</strong> to be executed
by one or more nodes on a cluster.</li>
<li>Each node of a cluster must be up and ready to receive and execute configurations
of simulations.</li>
<li><strong>None of the distributed simulations should get lost</strong>, meaning that in case of a node
failure, a <strong>recovery</strong> mechanism should redistribute the simulations assigned to the
failing node.</li>
<li>Once a simulation is computed by a node, results should be made available to the
user who launched the distribution.</li>
</ul>
</section><section>
<h1 id="design">Design</h1>
</section><section>
<h1 id="architecture">Architecture</h1>
<figure><img src="./img/Architecture.png" width="500">
</figure>

<p>Main actors:</p>
<ul>
<li><strong>AlchemistClient</strong>: Loads and distributes a simulation batch.</li>
<li><strong>AlchemistServer</strong>: Waits for job orders (mainly simulations) to execute.</li>
<li><strong>Registry</strong>: management of all the information that guarantees the correct functioning of the system</li>
<li><strong>Message Broker</strong>: responsible for the communication between nodes in the cluster.</li>
</ul>
</section><section>
<h1 id="domain-structure">Domain structure:</h1>
<figure><img src="./img/Design-structure.png">
</figure>

</section><section>
<h2 id="domain-structure-13">Domain structure (1/3)</h2>
<ul>
<li>
<p><strong>Cluster</strong> is an entity representing the collection of nodes that are currently connected forming a cluster. Through the cluster it is possible to obtain a <strong><em>Dispatcher</em></strong>, specifying the complexity that the nodes in the dispatcher should be able to handle.</p>
</li>
<li>
<p><strong>ClusterNode</strong> represent a server node to which jobs can be distributed.</p>
</li>
<li>
<p><strong>Dispatcher</strong> contains a subset of the nodes in the cluster. It is responsible for accepting <strong><em>SimulationBatches</em></strong> and distribute them across subset of nodes. Distribution is made according to a <strong><em>DispatchStrategy</em></strong></p>
</li>
<li>
<p><strong>DispatchStrategy</strong> it models the strategy with which the work load gets distributed to a collection of nodes (e.g. <em>round-robin</em>).</p>
</li>
</ul>
</section><section>
<h2 id="domain-structure-23">Domain structure (2/3)</h2>
<ul>
<li>
<p><strong>Complexity</strong> describes the complexity in terms of ram usage and memory occupation for the simulations in a batch.</p>
</li>
<li>
<p><strong>SimulationBatch</strong> represents a simulation batch with its complexity. It is composed of a simulation configuration and a collection of simulation initializers.</p>
</li>
<li>
<p><strong>SimulationConfig</strong> contains the general batch information such as the end step and end time of the simulations and a loader from which simulation instances will be created. <strong><em>Dependencies</em></strong> are files that must be made available to all servers in order to execute the simulation correctly.</p>
</li>
</ul>
</section><section>
<h2 id="domain-structure-33">Domain structure (3/3)</h2>
<ul>
<li>
<p><strong>SimulationInitializer</strong> contains a combination of variables values that will be used to create a simulation instance. For every simulation initializer in a simulation batch corresponds a job for a node in the cluster.</p>
</li>
<li>
<p><strong>BatchResult</strong> models the result of a simulation batch that have been submitted via a <strong><em>Dispatcher</em></strong>. It gives information on the total number of errors, if any, that have occurred while executing the simulation batch and a utility method to save all the distributed export files locally.</p>
</li>
<li>
<p><strong>SimulationResult</strong> models the result of a single job.</p>
</li>
</ul>
</section><section>
<h1 id="main-interactions">Main Interactions</h1>

<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col "><figure><img src="./img/Simulation_distribution_interactions.png" alt="Simulation distribution"><figcaption>
      <p>Simulation distribution</p>
    </figcaption>
</figure>
</div>
<div class="col "><figure><img src="./img/ClusterFaultDetector.png" alt="Fault detector"><figcaption>
      <p>Fault detector</p>
    </figcaption>
</figure>
</div></div>
</div>
</section><section>
<h1 id="behavior">Behavior</h1>

<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col "><figure><img src="./img/AlchemistServer-state.png" alt="Alchemist server"><figcaption>
      <p>Alchemist server</p>
    </figcaption>
</figure>
</div>
<div class="col "><figure><img src="./img/AlchemistClient-state.png" alt="Alchemist client"><figcaption>
      <p>Alchemist client</p>
    </figcaption>
</figure>
</div></div>
</div>
</section><section>
<h1 id="implementation-details">Implementation details</h1>
<h2 id="technologies">Technologies</h2>
<ul>
<li><strong>Etcd</strong>: a distributed, reliable and strongly consistent key-value store. It has been used to store the most important data for the functioning of the system (The registry)</li>
</ul>
<figure><img src="./img/Registry-KVStore.png">
</figure>

</section><section>
<h1 id="implementation-details-1">Implementation details</h1>
<h2 id="technologies-1">Technologies</h2>
<ul>
<li><strong>RabbitMQ</strong>: an open-source message broker based on the Advanced Message Queuing Protocol (AMQP) for reliable communication.</li>
</ul>
<figure><img src="./img/CommunicationQueues.png">
</figure>

</section><section>
<h1 id="implementation-details-2">Implementation details</h1>
<h2 id="technologies-2">Technologies</h2>
<ul>
<li><strong>Protobuf</strong>: Protocol Buffers are a language-neutral, platform-neutral extensible mechanism for serializing structured data.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">Simulation</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>  <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#000">simulationID</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>  <span style="color:#204a87;font-weight:bold">bytes</span> <span style="color:#000">environment</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>  <span style="color:#204a87;font-weight:bold">bytes</span> <span style="color:#000">exports</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>  <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#000">jobDescriptor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span></code></pre></div></section><section>
<h1 id="testing">Testing</h1>
<ul>
<li>A series of test have been written to assess whether the system complies with the project requirements.</li>
<li>Main challenges (as with distributed systems in general): dealing with <strong>asynchronous behavior</strong> and <strong>non-determinism</strong>.</li>
<li>For this the Kotest testing framework came in handy.</li>
</ul>
</section><section>
<h1 id="testing-1">Testing</h1>
<p>A test example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#4e9a06">"Simulation are correctly distributed"</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">startServers</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">serverConfigFile</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">SERVERS_TO_LAUNCH</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">use</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">cluster</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">ClusterImpl</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">registry</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">awaitServerJoin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cluster</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">SERVERS_TO_LAUNCH</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10.</span><span style="color:#000">seconds</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">startClient</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">clientConfigFile</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">use</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">until</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">20.</span><span style="color:#000">seconds</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">registry</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">simulations</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">simulationID</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">registry</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">simulations</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">first</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">registry</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">simulationJobs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">simulationID</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">shouldHaveSize</span> <span style="color:#000">SIMULATION_BATCH_SIZE</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Kotest functions for non-determinism:</p>
<ul>
<li><code>eventually</code></li>
<li><code>continually</code></li>
<li><code>until</code></li>
</ul>
</section><section>
<h1 id="future-works">Future works</h1>
<ul>
<li>Implementation of a cluster monitoring &amp; management <strong>dashboard</strong></li>
<li>Improvement on the <strong>fault detection routine</strong></li>
<li>New dispacth strategies based also on the <strong>heterogeneity of the computing nodes</strong> and the <strong>complexity of a simulation batch</strong></li>
</ul>
</section><section>
<h1 id="demo">DEMO</h1>
<p><a href="https://github.com/kelvin-olaiya/exam-ds-demo">repository</a></p>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="./reveal-hugo/object-assign.js"></script>

<a href="./reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"900","highlight_theme":"solarized-dark","history":true,"mermaid":[{}],"slide_number":true,"theme":"league","transition":"slide","transition_speed":"fast","width":"1440"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="./reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="./reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="./reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="./reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="./reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="./reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }

  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = {
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>







  
  

  
  

  
  





    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>


    
  

</body></html>